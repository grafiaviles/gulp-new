<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="/static/RDF/site/content/regalos-navidad/css/main.min.css">
    <title>Recomendador de Regalos Navidad - Falabella.com</title>
</head>

<body>
    <!-- Init New Section -->
    <main class="main-module">
        <!-- Init Spinners -->
        <div class="cont-cargador hide">
            <div class="lds-ring">
                <div></div>
                <div></div>
                <div></div>
                <div></div>
            </div>
        </div>
        <!-- Init Header -->
        <div class="header">
            <div class="header__background">
                <div class="header-left">
                    <h1 class="title-header">Encuentra el regalo perfecto!
                        <img class="regalo-3-header" src="/static/RDF/site/content/regalos-navidad/img/regalo-small-3.svg" width="60" alt="iconos regalos">
                    </h1>
                    <p class="text-header hide-tablet">Con unos simples datos te recomendaremos los mejores regalos para esa persona especial!</p>
                </div>
            </div>
            <img class="regalo-small-header hide" src="/static/RDF/site/content/regalos-navidad/img/regalo-small.svg" width="150" alt="iconos regalos">
            <img class="regalo-small-2-header hide" src="/static/RDF/site/content/regalos-navidad/img/regalo-small-2.svg" width="130" alt="iconos regalos">
        </div>
        <!-- Init Formulario de Navidad -->
        <section class="grid-container container-module">
            <form class="form-regalos " id="contact-regalos" name="contacto-regalos" action="data-regalos.php" method="POST" autocomplete="off">
                <!-- Container User 1 Autofocus -->
                <div class="cont-form row-input">
                    <figure class="cont-icons-user">
                        <img src="/static/RDF/site/content/regalos-navidad/img/user-1.svg" alt="Usuario">
                    </figure>
                    <div class="cont-input">
                        <div class="grid-1-4 input-field">
                            <input class="" id="nombreApodo" type="text" placeholder="Nombre / Apodo" autofocus>
                            <div class="msje-error-input hide">Se requiere un nombre o apodo de la persona</div>
                        </div>
                        <div class="grid-1-4 input-field">
                            <select id="tipo" class="select">
                                <option value="hide">Tipo</option>
                                <option value="MU">Mujer</option>
                                <option value="HO">Hombre</option>
                                <option value="NI">Niños</option>
                                <option value="TE">Teens</option>
                                <option value="MA">Mascotas</option>
                            </select>
                            <div class="msje-error-input hide">Se requiere un tipo de persona</div>
                        </div>

                        <div class="grid-1-4 input-field">
                            <input class="" id="edad" type="number" placeholder="Edad">
                            <div class="msje-error-input hide">Se requiere la edad de la persona</div>
                        </div>

                        <div class="grid-1-4 input-field">
                            <select id="interes" class="select">
                                <option value="hide">Intereses</option>
                                <option value="TE">Tecnológico</option>
                                <option value="SM">Siempre a la moda</option>
                                <option value="AV">Aventurero</option>
                                <option value="DE">Deportista</option>
                                <option value="GO">Gourmet</option>
                                <option value="MU">Músico</option>
                                <option value="HU">Hágalo usted mismo</option>
                                <option value="SE">Senior</option>
                            </select>
                            <div class="msje-error-input hide">Se requiere un interés por persona</div>
                        </div>
                    </div>
                </div>
                <!-- Container User 2 -->
                <div class="cont-form row-input">
                    <figure class="cont-icons-user">
                        <img src="/static/RDF/site/content/regalos-navidad/img/user-2.svg" alt="Usuario">
                    </figure>
                    <div class="cont-input">
                        <div class="grid-1-4 input-field">
                            <input class="" id="nombreApodo" type="text" placeholder="Nombre / Apodo">
                            <div class="msje-error-input hide">Se requiere un nombre o apodo de la persona</div>
                        </div>
                        <div class="grid-1-4 input-field">
                            <select id="tipo" class="select">
                                    <option value="hide">Tipo</option>
                                    <option value="MU">Mujer</option>
                                    <option value="HO">Hombre</option>
                                    <option value="NI">Niños</option>
                                    <option value="TE">Teens</option>
                                    <option value="MA">Mascotas</option>
                                </select>
                            <div class="msje-error-input hide">Se requiere un tipo de persona</div>
                        </div>

                        <div class="grid-1-4 input-field">
                            <input class="" id="edad" type="number" placeholder="Edad">
                            <div class="msje-error-input hide">Se requiere la edad de la persona</div>
                        </div>

                        <div class="grid-1-4 input-field">
                            <select id="interes" class="select">
                                    <option value="hide">Intereses</option>
                                    <option value="TE">Tecnológico</option>
                                    <option value="SM">Siempre a la moda</option>
                                    <option value="AV">Aventurero</option>
                                    <option value="DE">Deportista</option>
                                    <option value="GO">Gourmet</option>
                                    <option value="MU">Músico</option>
                                    <option value="HU">Hágalo usted mismo</option>
                                    <option value="SE">Senior</option>
                                </select>
                            <div class="msje-error-input hide">Se requiere un interés por persona</div>
                        </div>
                    </div>
                    <!-- Delete Row -->
                    <div id="deleteRow" class="delete-row">
                        <p class="text-delete">Eliminar</p>
                        <img class="close-img" src="/static/RDF/site/content/regalos-navidad/img/close.svg" width="17">
                    </div>
                </div>
                <!-- Container Agregar Usuario -->
                <div id="addRow" class="cont-form cont-add">
                    <figure id="agregar-usuario" class="cont-icons-user cont-icons-user-plus">
                        <img src="/static/RDF/site/content/regalos-navidad/img/user-plus.svg" class="" alt="Agregar otro usuario">
                        <!-- .img-disabled -->
                        <span class="text-agregar">Agregar</span>
                        <!-- .btn-disabled -->
                    </figure>
                </div>
                <!-- Boton Enviar -->
                <div class="cont-form cont-btn">
                    <div class="row-data">
                        <p class="cont-chekcbox">
                            <label>
                                <input id="checkNavidad" type="checkbox"/>
                                <span>Al enviar estás aceptando <a href="" class="terminos">términos y condiciones</a></span>
                            </label>
                        </p>
                        <div class="msje-error-input hide">Este campo es obligtorio</div>
                    </div>
                    <div class="row-data grid-1-2">
                        <div class="cont-input grid-1-2">
                            <figure class="cont-icons-user">
                                <img src="/static/RDF/site/content/regalos-navidad/img/mail.svg" alt="Ingresa tu email">
                            </figure>
                            <input id="email" type="email" placeholder="Ingresa tu email">
                        </div>
                        <div class="cont-submit grid-1-2">
                            <button class="btn-enviar btn-disabled" type="submit" name="action">ENVIAR
                            <div class="lds-ring hide">
                                <div></div>
                                <div></div>
                                <div></div>
                                <div></div>
                            </div>
                        </button>
                        </div>
                    </div>
                </div>
            </form>
        </section>
        <img class="regalo-big-page" src="/static/RDF/site/content/regalos-navidad/img/regalo-big.svg" alt="iconos regalos">
        <!-- NEW SUCCESS -->
        <section class="overlay-success hide">
            <div id="exito" class="modal-newsletter">
                <span id="close" class="close"><img src="/static/RDF/site/content/regalos-navidad/img/close.svg" alt=""></span>
                <div class="modal-content">
                    <div class="cont-title-modal">
                        <img class="icon-title-modal" src="/static/RDF/site/content/regalos-navidad/img/check-modal.svg" alt="">
                        <h1 class="title-modal">Mensaje enviado</h1>
                    </div>
                    <div class="msje-modal" id="exito">
                        <img class="img-success" src="/static/RDF/site/content/regalos-navidad/img/regalo-small-2.svg">
                        <h3 class="title-success">Perfecto, mensaje enviado.</h3>
                        <p class="text-success"> Lorem ipsum dolor sit amet consectetur adipisicing elit. </p>
                        <a href="#!" class="grid-1-2 btn-success">OK, Gracias</a>
                    </div>
                </div>
            </div>
            <div id="error" class="modal-newsletter">
                <span id="close" class="close"><img src="/static/RDF/site/content/regalos-navidad/img/close.svg" alt=""></span>
                <div class="modal-content">
                    <div class="cont-title-modal">
                        <img class="icon-title-modal" src="/static/RDF/site/content/regalos-navidad/img/error.svg" alt="">
                        <h1 class="title-modal">Lo sentimos</h1>
                    </div>
                    <div class="msje-modal" id="exito">
                        <img class="img-success" src="/static/RDF/site/content/regalos-navidad/img/regalo-small-2.svg">
                        <h3 class="title-success">No se pudo enviar su mensaje</h3>
                        <p class="text-success"> Lorem ipsum dolor sit amet consectetur adipisicing elit. </p>
                        <a href="#!" class="grid-1-2 btn-success">Intentar de nuevo</a>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <iframe src="" id="iframeChristmas" class="hide" width="0" height="0" frameborder="0" scrolling="no"></iframe>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="/static/RDF/site/content/regalos-navidad/js/dist/all.min.js"></script>
    <script>
        $('select').each(function() {
            //$this is each select
            //numberofOptions is the children of select, which are the options
            var $this = $(this),
                numberOfOptions = $(this).children('option').length;
            //it adds the class hidden
            $this.addClass('select-hidden');
            $this.wrap('<div class="select"></div>');
            $this.after('<div class="select-styled"></div>');

            var $styledSelect = $this.next('div.select-styled');

            $styledSelect.text($this.children('option').eq(0).text());
            var $list = $('<ul />', {
                'class': 'select-options'
            }).insertAfter($styledSelect);

            for (var i = 0; i < numberOfOptions; i++) {
                $('<li />', {
                    text: $this.children('option').eq(i).text(),
                    rel: $this.children('option').eq(i).val()
                }).appendTo($list);
            }
            var $listItems = $list.children('li');
            $styledSelect.click(function(e) {
                e.stopPropagation();
                $('div.select-styled.active').not(this).each(function() {
                    $(this).removeClass('active').next('ul.select-options').hide();
                });
                $(this).toggleClass('active').next('ul.select-options').toggle();

            });

            $listItems.click(function(e) {

                e.stopPropagation();
                $styledSelect.text($(this).text()).removeClass('active');
                $this.val($(this).attr('rel'));
                $list.hide();
                switchInteres($this.val(), this.closest('.cont-input'));
            });

            $(document).click(function() {
                $styledSelect.removeClass('active');
                $list.hide();
            });

        });
        //here goes button algorithm

        checkEmailParam();
        addEventXmasButton();
        addXmasButtonListener();

        function checkEmailParam() {

            var formattedUrl = new URL(window.location.href);
            var emailParam = formattedUrl.searchParams.get('mail');
            if (emailParam) {
                var mailField = document.querySelector('#email');
                var checkBoxNavidad = document.querySelector('#checkNavidad');
                mailField.value = emailParam;
                document.querySelector('#email').parentNode.style.display = 'none';
                checkBoxNavidad.closest('.row-data').style.display = 'none';
                checkBoxNavidad.checked = true;
            }
        }

        function addXmasButtonListener() {

            var xmasButton = document.querySelector('#contact-regalos').querySelector('.btn-enviar');
            xmasButton.classList.remove('btn-disabled');
            xmasButton.addEventListener('click', function() {
                event.preventDefault();
                sendInfoXmas();
                xmasButton.querySelector('.lds-ring').classList.remove('hide');
                xmasButton.innerText = "";
                setTimeout((xmasButton) => {
                    xmasButton.innerText = "ENVIAR";
                    xmasButton.querySelector('.lds-ring').classList.add('hide');
                }, 2000);
            });
        }

        function sendInfoXmas() {
            var urlXmas = "https://pub.s6.exacttarget.com/gpt3oi5apcb?";
            var friendsInput = Array.prototype.slice.call(document.querySelectorAll('.cont-input'));
            var friendsInfo = friendsInput.map(function(el, index) {

                return getInfo(el, index);

            });

            friendsInfo.forEach(function(el) {

                urlXmas = urlXmas + el;
            });
            urlXmas = urlXmas.replace('undefined', '') + getEmptyInfo(friendsInput.length);
            urlXmas = urlXmas + getMail() + getOptIn() + '&estado=NO';
            console.log(urlXmas);
            document.querySelector('#iframeChristmas').setAttribute('src', urlXmas);
        }

        function getInfo(el, index) {
            if (!el.classList.contains('grid-1-2')) {
                var nombreApodo = el.querySelector("#nombreApodo").value,
                    tipoAmigo = el.querySelector("#tipo").value,
                    edadAmigo = el.querySelector("#edad").value,
                    interesAmigo = el.querySelector("#interes").value,
                    identifier = index + 1;
                let formattedNombre = 'nombre' + identifier + '=' + nombreApodo.replace(/\s/g, "-"),
                    formattedTipo = '&tipo' + identifier + '=' + tipoAmigo,
                    formattedEdad = '&edad' + identifier + '=' + edadAmigo,
                    formattedRango = '&rango' + identifier + '=' + getRangoEdad(edadAmigo),
                    formattedInteres = '&intereses' + identifier + '=' + interesAmigo,
                    formattedId = '&id' + identifier + '=' + tipoAmigo + interesAmigo + '&';
                return formattedNombre + formattedTipo + formattedEdad + formattedRango + formattedInteres + formattedId;
            }

        }

        function getMail() {

            let stringEmail = "mail=" + document.querySelector('#contact-regalos').querySelector('#email').value;
            return stringEmail;
        }

        function getOptIn() {
            let resultOptIn = document.querySelector('#contact-regalos').querySelector('#checkNavidad').checked ? true : false;
            return '&optin=' + resultOptIn;
        }

        function getEmptyInfo(length) {
            var emptyString;
            for (var i = length; i <= 5; i++) {
                if (emptyString === undefined) {
                    emptyString = 'nombre' + i + '=no&tipo' + i + '=no&edad' + i + '=no&rango' + i + '=no&intereses' + i + '=no&id' + i + '=no&';

                } else {

                    emptyString = emptyString + 'nombre' + i + '=no&tipo' + i + '=no&edad' + i + '=no&rango' + i + '=no&intereses' + i + '=no&id' + i + '=no&';

                }

            }

            return emptyString;

        }

        function getRangoEdad(integer) {
            switch (parseInt(integer)) {
                case 0:
                    return 'b-b';
                    break;
                case 1:
                case 2:
                    return '1-2';
                    break;
                case 3:
                case 4:
                    return '3-4';
                    break;
                case 5:
                case 6:
                case 7:
                    return '5-7';
                    break;
                case 8:
                case 9:
                case 10:
                case 11:
                case 12:
                case 13:
                    return '8-13';
                    break;
                default:

                    return '14-99';

            }
        }

        //Create new Input

        function addEventXmasButton() {

            var addButtonXmas = document.querySelector('.text-agregar');

            addButtonXmas.addEventListener('click', function() {
                cloneInputXmas();

            });
        }

        function cloneInputXmas() {

            var dupNode = document.querySelector('.cont-form').cloneNode(true);
            var numberToAdd = document.querySelectorAll('.cont-input').length;
            if (numberToAdd < 6) {
                dupNode.querySelector('img').setAttribute('src', '/static/RDF/site/content/regalos-navidad/img/user-' + numberToAdd + '.svg');
                document.querySelector('#contact-regalos').insertBefore(dupNode, document.querySelector('#addRow'));
                testCesar();
                if (numberToAdd === 6) {
                    var buttonContainer = document.querySelector('#addRow');
                    buttonContainer.querySelector('img').classList.add('.img-disabled');
                    buttonContainer.querySelector('span').classList.add('.btn-disabled');
                }
            }

        }

        //Here goes On success

        function switchInteres(value, parent) {
            var intereseObject = {
                "HO": ["Tipo-hide", "Tecnologico-TE", "Siempre_a_la_Moda-SM", "Aventurero-AV", "Deportista-DE", "Gourmet-GO", "Musico-MU", "Hagalo_Usted_Mismo-HU", "Senior-SE", "Casa_Siempre_Linda-CL", "Intelectual-IT"],
                "MU": ["Tipo-hide", "Tecnologica-TE", "Siempre_a_la_Moda-SM", "Aventurera-AV", "Deportista-DE", "Gourmet-GO", "Decoradora-DC", "Intelectual-IT", "Senior-SE"],
                "MA": ["Tipo-hide", "Perros-PE", "Gatos-GA", "Animales_Pequenos-AP", "Pet_Lover-PL"],
                "TE": ["Tipo-hide", "Fashion_Mujer-SMM", "Fashion_Hombre-SMH", "Tecnologico-TE", "Aventurero-AV", "Deportista-DE", "Chef-CH", "Intelectual-IT", "Musico-MU"],
                "FA": ["Tipo-hide", "Aventureras-AV", "Tecnologicas-TE", "Deportista-DE", "Gourmet-GO", "Relax-RE"],
                "NI": ["Tipo-hide", "Cientificos-CI", "Heroes_y_Princesas-HP", "Constructores-CN", "Artistas-AR", "Tecnologico-TE", "Aventureros-AV", "Actores-AC", "Papa_y_Mama-RO", "Fanaticos-FN"]
            };

            if (parent) {
                var listInteres = parent.querySelector('#interes');
                var options = parent.querySelectorAll('.select-options')[1]
                console.log(options);
                if (intereseObject[value]) {
                    listInteres.innerHTML = '';
                    options.innerHTML = '';
                    intereseObject[value].forEach(function(el) {
                        options.appendChild(createXmasLi(el));
                        listInteres.appendChild(createXmasOptions(el));
                    });
                    testCesar();
                }

            }



        }

        function createXmasLi(el) {
            var singleLi = document.createElement('li'),
                matchedString = el.match(/(\w+)-(\w+)/);
            singleLi.innerText = matchedString[1].replace(/_/g, ' ');
            singleLi.setAttribute('rel', matchedString[2]);
            return singleLi;
        }

        function createXmasOptions(el) {
            var singleOption = document.createElement('option'),
                matchedString = el.match(/(\w+)-(\w+)/);
            singleOption.innerText = matchedString[1].replace(/_/g, ' ');
            singleOption.setAttribute('value', matchedString[2]);
            return singleOption;
        }

        function testCesar() {

            $('select').each(function() {

                var $this = $(this),
                    numberOfOptions = $(this).children('option').length;
                $this.addClass('select-hidden');
                var $list = $(this).parent().children('ul');

                var $styledSelect = $this.next('div.select-styled');
                var $listItems = $list.children('li');
                console.log($listItems);
                $listItems.off();
                $styledSelect.off();
                $styledSelect.click(function(e) {
                    e.stopPropagation();
                    $('div.select-styled.active').not(this).each(function() {
                        $(this).removeClass('active').next('ul.select-options').hide();

                    });
                    $(this).toggleClass('active').next('ul.select-options').toggle();
                });
                $listItems.click(function(e) {
                    e.stopPropagation();
                    $styledSelect.text($(this).text()).removeClass('active');
                    console.log($(this).attr('rel'));
                    $this.val($(this).attr('rel'));
                    $list.hide();
                    switchInteres($this.val(), this.closest('.cont-input'));
                });

            });


        }
    </script>
</body>